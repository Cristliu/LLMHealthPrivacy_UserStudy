{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>AI-LLM-based Healthcare Consultation</title>
    <link href="/static/img/AIH.ico" rel="icon" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}?v=2.0"> 
    <script src="{% static 'js/scripts2.js' %}?v=2.0" defer></script>
</head>
<body>
    <main class="container">

    {% if valid_token %}

        <h2 id='h2title'>AI-LLM-based Healthcare Consultation</h2>
        
        <div class="content">        
            <div id="infoForm">
                <label>
                    <p>Welcome to the AI-LLM-based Healthcare Consultation service.
                         Please prepare the healthcare questions you would like to ask, such as medical knowledge.</p>
                    <p><strong>Please note that the replies and advice provided by the healthcare chatbot are generated by an LLM known as GPT,
                         and these pieces of advice should be reviewed by a professional doctor before implementation. Please reference them cautiously.
                    </strong></p>
                    <p><strong>If you have a medical background, please carefully evaluate the replies or advice from the AI-LLM.</strong></p>
                    </label>
                <label>Before starting the consultation, please choose whether to provide basic information such as age to receive personalized advice:</label>
                
                <div style="display: inline-block;">
                    <input type="radio" id="yes" name="provideInfo" value="yes"><label style="margin-right: 50px" for="yes">Yes</label>
                    <input type="radio" id="no" name="provideInfo" value="no"><label for="no">No</label>
                </div>

                <div id="additionalInfo" style="display:none;">
                    <div>
                        <label for="age">Age:</label>
                        <select id="age" required>
                            <option value="" disabled selected>Please choose</option>
                            <option value="18-24">18-24</option>
                            <option value="25-34">25-34</option>
                            <option value="35-44">35-44</option>
                            <option value="45-54">45-54</option>
                            <option value="55-64">55-64</option>
                            <option value="65+">65 or older</option>
                        </select>
                    </div>
                
                    <div>
                        <label for="gender">Gender:</label>
                        <select id="gender" required>
                            <option value="" disabled selected>Please choose</option>
                            <option value="Male">Man</option>
                            <option value="Female">Woman</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                
                    <div>
                        <label for="occupation">Occupation or Identity:</label>
                        <input type="text" id="occupation" name="occupation" required placeholder="Please enter">
                    </div>
                </div>                
                
            </div>

            <label style="margin-left:10px">Please click the button below to enter the consultation page</label>
        </div>
            <div class="button-container">
                <button onclick="showConsultation('multiple')">Enter Consultation Page</button>
            </div>
       
        <div class="chat-container" id="chatSession" style="display:none;">

            <div class="messages" id="messages">
                <div class="message gpt-message">
                    <img src="{% static 'img/GPTDoc.png' %}" class="avatar">
                    <div class="text-content">
                        <p>Hello! I am an AI-LLM-based healthcare chatbot, acting as your health assistant. I can answer your healthcare questions.
                            The advice provided is for reference only, please use it cautiously in actual medical decision-making.
                            When you want to end the consultation, click “End Consultation” below to access the questionnaire.
                        Remember your session ID is <strong>{{ user_session_id }}, you will need it for the questionnaire!</strong></p>
                        </div>
                </div>
            </div>
            
            <div class="suggestions">
                <button class="suggestion-btn" onclick="insertText('How to relieve eye fatigue?')">How to relieve eye fatigue?</button>
                <button class="suggestion-btn" onclick="insertText('What massage methods can relieve stomach pain?')">What massage methods can relieve stomach pain?</button>
                <button class="suggestion-btn" onclick="insertText('Is dexamethasone a fever reducer?')">Is dexamethasone a fever reducer?</button>
            </div>

            <script type="text/javascript">
                var sessionId = "{{ user_session_id }}";
            </script>

            <div class ="input-container">
                <textarea id="message-input" placeholder="Enter your question here, or click on the common questions above and launch the consultation through the “Send Question” button"></textarea>
                <div class="button-row">
                    <input type="button" class="styled-button" id="send-button" value="Send Question">
                    <input type="button" class="end-styled-button" id="end-button" value="End Consultation">
                </div>
            </div>
        </div>

    {% else %}
            <h2>Please read and agree to the informed consent first</h2>
    {% endif %}

    </main>
</body>

</html>
